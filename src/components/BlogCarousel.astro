---
interface BlogPost {
  title: string;
  url: string;
  excerpt: string;
  pubDate: string;
}

let posts: BlogPost[] = [];

try {
  const response = await fetch('https://blog.devcult.io/rss.xml');
  const xml = await response.text();

  // Simple RSS parsing
  const items = xml.match(/<item>([\s\S]*?)<\/item>/g) || [];
  posts = items.slice(0, 6).map(item => {
    const title = item.match(/<title><!\[CDATA\[(.*?)\]\]><\/title>/)?.[1] || item.match(/<title>(.*?)<\/title>/)?.[1] || '';
    const url = item.match(/<link>(.*?)<\/link>/)?.[1] || '';
    const excerpt = item.match(/<description><!\[CDATA\[(.*?)\]\]><\/description>/)?.[1] || item.match(/<description>(.*?)<\/description>/)?.[1] || '';
    const pubDate = item.match(/<pubDate>(.*?)<\/pubDate>/)?.[1] || '';
    return { title, url, excerpt: excerpt.slice(0, 150) + '...', pubDate };
  });
} catch (e) {
  console.error('Failed to fetch blog posts:', e);
}
---

<section class="py-24 bg-[--color-bg-secondary]">
  <div class="mx-auto max-w-7xl px-6">
    <h2 data-animate class="text-3xl md:text-4xl font-bold font-[--font-coconat] text-center">
      Latest from the Blog
    </h2>

    {posts.length > 0 ? (
      <div class="mt-12 overflow-x-auto pb-4 -mx-6 px-6">
        <div class="flex gap-6 w-max md:w-full md:grid md:grid-cols-3">
          {posts.slice(0, 3).map((post, i) => (
            <a
              href={post.url}
              data-animate
              data-delay={100 + i * 100}
              class="w-80 md:w-auto p-6 rounded-xl bg-[--color-bg-primary] border border-[--color-border] hover:border-[--color-accent] transition-all group"
            >
              <p class="text-xs text-[--color-text-tertiary]">
                {new Date(post.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
              </p>
              <h3 class="mt-2 font-semibold font-[--font-coconat] line-clamp-2 group-hover:text-[--color-accent] transition-colors">
                {post.title}
              </h3>
              <p class="mt-2 text-sm text-[--color-text-secondary] line-clamp-2">
                {post.excerpt}
              </p>
              <span class="mt-4 inline-block text-sm text-[--color-accent]">
                Read article →
              </span>
            </a>
          ))}
        </div>
      </div>
    ) : (
      <div data-animate class="mt-12 text-center">
        <p class="text-[--color-text-secondary]">
          Check out our latest articles on the blog.
        </p>
        <a
          href="https://blog.devcult.io"
          class="mt-4 inline-block text-[--color-accent] hover:text-[--color-accent-hover]"
        >
          Visit blog.devcult.io →
        </a>
      </div>
    )}
  </div>
</section>
