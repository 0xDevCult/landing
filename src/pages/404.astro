---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';

const devJokes = [
  'Why do programmers prefer dark mode? Because light attracts bugs!',
  "There are only 10 types of people in the world: those who understand binary, and those who don't.",
  "A SQL query walks into a bar, walks up to two tables and asks... 'Can I join you?'",
  "Why do Java developers wear glasses? Because they can't C#.",
  "How many programmers does it take to change a light bulb? None. It's a hardware problem.",
  "What's a programmer's favorite hangout place? The Foo Bar.",
  'Why did the developer go broke? Because he used up all his cache.',
  'I would tell you a UDP joke, but you might not get it.',
  'I told my wife she was drawing her eyebrows too high. She looked surprised.',
  "Why did the programmer quit his job? Because he didn't get arrays.",
  'What do you call a programmer from Finland? Nerdic.',
  'Debugging: Being the detective in a crime movie where you are also the murderer.',
  "It's not a bug, it's an undocumented feature.",
  'Why do programmers always mix up Halloween and Christmas? Because Oct 31 == Dec 25.',
  "I'm not lazy, I'm just on energy-saving mode.",
  "404: Humor not found. Just kidding, it's in the cache.",
  'To understand what recursion is, you must first understand recursion.',
  'There are two hard things in computer science: cache invalidation, naming things, and off-by-one errors.',
  "Git commit -m 'Fixed the bug'. Git commit -m 'Actually fixed it this time'.",
  "I don't always test my code, but when I do, I do it in production.",
];

// Server-side randomization - this will be different on each build
const randomIndex = Math.floor(Math.random() * devJokes.length);
const serverJoke = devJokes[randomIndex];
---

<BaseLayout
  title="404 - Page Not Found | DevCult"
  description="Oops! The page you're looking for doesn't exist."
>
  <Header />

  <main id="main-content" class="flex-1 flex items-center justify-center py-12 px-6">
    <div class="max-w-2xl mx-auto text-center">
      <div data-animate class="mb-8">
        <div class="glitch-container">
          <h1 class="glitch-text text-9xl font-bold font-coconat text-accent" data-text="404">
            404
          </h1>
          <h1 class="glitch-alt text-9xl font-bold font-coconat text-accent">Lost?</h1>
        </div>
        <div class="mt-4 h-1 w-24 mx-auto bg-gradient-to-r from-accent to-accent-hover"></div>
      </div>

      <h2
        data-animate
        data-delay="100"
        class="text-3xl md:text-4xl font-semibold font-coconat mb-4"
      >
        Page Not Found
      </h2>

      <p data-animate data-delay="200" class="text-lg text-text-secondary mb-8">
        Looks like this page took a detour to <code
          class="text-accent bg-brand-alpha-5 px-2 py-1 rounded">/dev/null</code
        >
      </p>

      <!-- Random Dev Joke -->
      <div
        data-animate
        data-delay="300"
        class="mb-12 p-6 rounded-xl bg-brand-alpha-5 border-l-4 border-l-brand-500 border-t border-t-brand-500 border-r border-r-brand-500 border-b border-b-brand-500 hover:border-l-brand-400 transition-all group"
      >
        <p class="text-sm text-accent mb-2 font-semibold">WHILE YOU'RE HERE...</p>
        <p id="joke-text" class="text-base text-text-primary italic">
          {serverJoke}
        </p>
        <button
          id="new-joke-btn"
          class="mt-4 text-sm text-accent hover:text-accent-hover transition-colors underline"
        >
          Tell me another one â†’
        </button>
      </div>

      <div data-animate data-delay="400" class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href="/"
          class="px-6 py-3 rounded-xl bg-accent font-semibold hover:bg-accent-hover transition-all"
          style="color: black;"
        >
          Go Home
        </a>
        <a
          href="/contact"
          class="px-6 py-3 rounded-xl border border-accent text-accent font-semibold hover:bg-brand-alpha-5 transition-all"
        >
          Contact Us
        </a>
      </div>
    </div>
  </main>

  <Footer />
</BaseLayout>

<script define:vars={{ jokes: devJokes }}>
  const jokeText = document.getElementById('joke-text');
  const newJokeBtn = document.getElementById('new-joke-btn');

  function getRandomJoke() {
    const randomIndex = Math.floor(Math.random() * jokes.length);
    return jokes[randomIndex];
  }

  newJokeBtn?.addEventListener('click', () => {
    if (jokeText) {
      // Add fade out animation
      jokeText.style.opacity = '0.3';
      jokeText.style.transition = 'opacity 0.2s';

      setTimeout(() => {
        jokeText.textContent = getRandomJoke();
        jokeText.style.opacity = '1';
      }, 200);
    }
  });
</script>

<style>
  .glitch-container {
    position: relative;
    display: inline-block;
    isolation: isolate;
  }

  /* Main text with data corruption effect */
  .glitch-text {
    position: relative;
    animation: glitch-skew 8s infinite ease-in-out;
    text-shadow:
      0 0 2px var(--color-accent),
      0 0 30px rgba(255, 106, 0, 0.3);
  }

  /* Chromatic aberration layers */
  .glitch-text::before,
  .glitch-text::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.8;
  }

  /* Cyan channel - left shift */
  .glitch-text::before {
    color: #0ff;
    animation: glitch-cyan 3s infinite steps(2, jump-none);
    clip-path: inset(0 0 0 0);
    mix-blend-mode: screen;
  }

  /* Magenta channel - right shift */
  .glitch-text::after {
    color: #f0f;
    animation: glitch-magenta 2.5s infinite steps(2, jump-none);
    clip-path: inset(0 0 0 0);
    mix-blend-mode: screen;
  }

  /* Alternative text that glitches in */
  .glitch-alt {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    animation: glitch-swap 7s infinite;
    text-shadow:
      0 0 20px var(--color-accent),
      0 0 40px rgba(255, 106, 0, 0.5);
    white-space: nowrap;
  }

  /* Scan line overlay */
  .glitch-container::before {
    content: '';
    position: absolute;
    inset: -20%;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0, 0, 0, 0.1) 2px,
      rgba(0, 0, 0, 0.1) 4px
    );
    pointer-events: none;
    animation: scanline-move 8s linear infinite;
    z-index: 10;
  }

  /* Noise overlay */
  .glitch-container::after {
    content: '';
    position: absolute;
    inset: -10%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.03;
    pointer-events: none;
    animation: noise-flicker 0.5s steps(5) infinite;
    z-index: 11;
  }

  @keyframes glitch-cyan {
    0%,
    100% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
    5% {
      transform: translate(-4px, 0);
      clip-path: inset(10% 0 80% 0);
    }
    10% {
      transform: translate(2px, 0);
      clip-path: inset(50% 0 30% 0);
    }
    15% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
    50% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
    52% {
      transform: translate(-6px, 2px);
      clip-path: inset(20% 0 60% 0);
    }
    54% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
  }

  @keyframes glitch-magenta {
    0%,
    100% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
    8% {
      transform: translate(4px, 0);
      clip-path: inset(60% 0 20% 0);
    }
    12% {
      transform: translate(-2px, 0);
      clip-path: inset(30% 0 50% 0);
    }
    16% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
    45% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
    48% {
      transform: translate(5px, -2px);
      clip-path: inset(40% 0 40% 0);
    }
    51% {
      transform: translate(0);
      clip-path: inset(0 0 0 0);
    }
  }

  @keyframes glitch-skew {
    0%,
    100% {
      transform: skew(0deg, 0deg);
    }
    2% {
      transform: skew(3deg, 0deg);
    }
    3% {
      transform: skew(-2deg, 1deg);
    }
    4% {
      transform: skew(0deg, 0deg);
    }
    30% {
      transform: skew(0deg, 0deg);
    }
    31% {
      transform: skew(-4deg, 0deg) translateX(-3px);
    }
    32% {
      transform: skew(2deg, -1deg) translateX(2px);
    }
    33% {
      transform: skew(0deg, 0deg);
    }
    70% {
      transform: skew(0deg, 0deg);
    }
    71% {
      transform: skew(1deg, 2deg);
    }
    72% {
      transform: skew(0deg, 0deg);
    }
  }

  @keyframes glitch-swap {
    0%,
    84%,
    100% {
      opacity: 0;
      transform: translateX(-50%) skew(0deg);
    }
    85% {
      opacity: 0;
      transform: translateX(-50%) skew(0deg);
    }
    86% {
      opacity: 1;
      transform: translateX(-45%) skew(-10deg);
    }
    87% {
      opacity: 0.5;
      transform: translateX(-55%) skew(8deg);
    }
    88% {
      opacity: 1;
      transform: translateX(-50%) skew(-5deg);
    }
    89% {
      opacity: 1;
      transform: translateX(-48%) skew(3deg);
    }
    90% {
      opacity: 1;
      transform: translateX(-50%) skew(0deg);
    }
    93% {
      opacity: 1;
      transform: translateX(-50%) skew(0deg);
    }
    94% {
      opacity: 0.7;
      transform: translateX(-52%) skew(-6deg);
    }
    95% {
      opacity: 0;
      transform: translateX(-50%) skew(0deg);
    }
  }

  @keyframes scanline-move {
    0% {
      transform: translateY(-100%);
    }
    100% {
      transform: translateY(100%);
    }
  }

  @keyframes noise-flicker {
    0%,
    100% {
      opacity: 0.03;
    }
    50% {
      opacity: 0.05;
    }
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .glitch-text,
    .glitch-text::before,
    .glitch-text::after,
    .glitch-alt,
    .glitch-container::before,
    .glitch-container::after {
      animation: none;
    }
    .glitch-text::before,
    .glitch-text::after,
    .glitch-alt,
    .glitch-container::before,
    .glitch-container::after {
      display: none;
    }
  }
</style>
